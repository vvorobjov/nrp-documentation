---
- name: Print all available facts
  ansible.builtin.debug:
    var: ansible_facts

- name: Archive the files
  archive:
    path: "{{ sphinx_build_html }}"
    dest: "{{ sphinx_build_html }}/src.zip"
    format: zip
  delegate_to: localhost
  become: false

- name: Clean artifact path
  file:
    state: absent
    path: "{{ deploy_dir }}/{{ docs_version }}"
  become: true

- name: Create a directory for docs on host if it does not exist
  ansible.builtin.file:
    path: "{{ deploy_dir }}/{{ docs_version }}"
    state: directory
    mode: '0755'
    owner: nrp
    group: www-data
  become: true

- name: Extract files to host
  ansible.builtin.unarchive:
    src: "{{ sphinx_build_html }}/src.zip"
    dest: "{{ deploy_dir }}/{{ docs_version }}"
    owner: nrp
    group: www-data
  become: true

- name: Clean artifact path
  file:
    state: absent
    path: "{{ deploy_dir }}/{{ docs_version }}/src.zip"
  become: true

- name: Link latest version
  file:
    path: "{{ latest_dir }}"
    src: "{{ deploy_dir }}/{{ docs_version }}"
    state: link
    owner: nrp
    group: www-data
    force: yes
  become: true
  when: "link_latest is 'true'"